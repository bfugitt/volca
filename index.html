<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volca Sample Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { height: 100vh; overflow: hidden; }
        .volca-gradient { background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%); }
        .step-btn { transition: all 0.05s; height: 100%; border-radius: 4px; }
        .step-active { background-color: #ef4444 !important; box-shadow: 0 0 8px #ef4444; }
        .current-step { outline: 2px solid #3b82f6; outline-offset: 1px; z-index: 10; }
        .grid-container { display: grid; grid-template-columns: 140px repeat(16, minmax(0, 1fr)); flex-grow: 1; gap: 4px; padding: 8px; overflow: hidden; }
        input[type=range].small-slider { height: 4px; -webkit-appearance: none; background: #444; border-radius: 2px; width: 100%; }
        input[type=range].small-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 10px; height: 10px; background: #ef4444; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body class="bg-gray-100 flex flex-col font-sans text-gray-800">

    <div class="volca-gradient p-2 text-white border-b-2 border-gray-800 flex justify-between items-center shrink-0">
        <div>
            <h1 class="text-sm font-bold tracking-tighter italic uppercase">Volca <span class="text-red-500">Sample Hub</span></h1>
        </div>
        <div id="midi-status" class="text-[8px] bg-gray-900 px-2 py-1 rounded-full border border-gray-600 text-gray-400 font-mono">MIDI: Disconnected</div>
    </div>

    <div class="p-2 space-y-2 flex flex-col flex-grow overflow-hidden">
        <div class="flex items-center justify-between bg-white p-2 rounded-xl border border-gray-200 shrink-0">
            <div class="flex items-center gap-4">
                <div class="flex flex-col gap-1 w-24">
                    <label class="text-[8px] font-black text-gray-400 uppercase">Tempo: <span id="tempo-val" class="text-gray-800">120</span></label>
                    <input type="range" id="tempo-slider" min="40" max="240" value="120" class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-red-600">
                </div>
                <button id="play-btn" class="bg-green-600 hover:bg-green-500 text-white text-[10px] px-4 py-1.5 rounded-full font-black uppercase shadow-[0_2px_0_0_rgba(22,101,52,1)] active:shadow-none active:translate-y-0.5 transition-all">▶ Play</button>
                <button id="clear-grid" class="text-[9px] border border-gray-300 px-3 py-1.5 rounded-full uppercase font-bold text-gray-500 hover:bg-gray-100">Clear</button>
            </div>
            <div class="text-[8px] text-gray-400 font-bold uppercase italic">Global: LED 9 & 10 ON</div>
        </div>

        <div id="sequencer-grid" class="grid-container bg-gray-200 rounded-xl border border-gray-300">
            <!-- JS Populated -->
        </div>
    </div>
    
    <div class="bg-gray-800 p-1 text-center shrink-0">
        <p id="midi-log" class="text-[8px] font-mono text-gray-500 uppercase tracking-widest">System Ready</p>
    </div>

    <script>
        let midiOut = null, isPlaying = false, currentStep = 0, tempo = 120, timerId = null;
        const PARTS = 10, STEPS = 16;
        const gridState = Array.from({ length: PARTS }, () => Array(STEPS).fill(0));

        if (navigator.requestMIDIAccess) {
            navigator.requestMIDIAccess().then(access => {
                const update = () => {
                    const outputs = Array.from(access.outputs.values());
                    midiOut = outputs[0] || null;
                    const status = document.getElementById('midi-status');
                    status.innerText = midiOut ? `ON: ${midiOut.name}` : "OFF";
                    status.style.color = midiOut ? "#4ade80" : "#f87171";
                };
                access.onstatechange = update;
                update();
            });
        }

        function sendMidi(c, n, v) { if (midiOut) midiOut.send([0x90 + c, n, v]); setTimeout(() => { if(midiOut) midiOut.send([0x80+c, n, 0])}, 20); }
        function sendCC(c, cc, v) { if (midiOut) midiOut.send([0xB0 + c, cc, v]); }

        const gridContainer = document.getElementById('sequencer-grid');
        function createGrid() {
            gridContainer.innerHTML = '';
            for (let r = 0; r < PARTS; r++) {
                const ctrl = document.createElement('div');
                ctrl.className = "flex flex-col justify-center gap-1 bg-white/50 p-1 rounded-lg";
                ctrl.innerHTML = `<div class="text-[8px] font-black">PART ${r+1}</div>
                    <input type="range" min="0" max="127" value="64" class="small-slider" oninput="sendCC(${r}, 43, this.value)">
                    <input type="range" min="0" max="127" value="127" class="small-slider" oninput="sendCC(${r}, 42, this.value)">`;
                gridContainer.appendChild(ctrl);
                for (let c = 0; c < STEPS; c++) {
                    const btn = document.createElement('button');
                    btn.className = `step-btn border ${Math.floor(c/4)%2===0 ? 'bg-white border-gray-300' : 'bg-gray-100 border-gray-300'}`;
                    btn.id = `step-${r}-${c}`;
                    btn.onclick = () => { gridState[r][c] = !gridState[r][c]; btn.classList.toggle('step-active'); if(gridState[r][c]) sendMidi(r, 60, 127); };
                    gridContainer.appendChild(btn);
                }
            }
        }
        createGrid();

        function playStep() {
            document.querySelectorAll('.step-btn').forEach(b => b.classList.remove('current-step'));
            for (let r = 0; r < PARTS; r++) {
                const btn = document.getElementById(`step-${r}-${currentStep}`);
                btn.classList.add('current-step');
                if (gridState[r][currentStep]) sendMidi(r, 60, 127);
            }
            currentStep = (currentStep + 1) % STEPS;
            timerId = setTimeout(playStep, (60000 / tempo) / 4);
        }

        document.getElementById('play-btn').onclick = (e) => {
            isPlaying = !isPlaying;
            if (isPlaying) { e.target.innerText = "■ Stop"; currentStep = 0; playStep(); }
            else { e.target.innerText = "▶ Play"; clearTimeout(timerId); document.querySelectorAll('.step-btn').forEach(b => b.classList.remove('current-step')); }
        };
        document.getElementById('tempo-slider').oninput = (e) => { tempo = e.target.value; document.getElementById('tempo-val').innerText = tempo; };
        document.getElementById('clear-grid').onclick = () => { gridState.forEach(r => r.fill(0)); document.querySelectorAll('.step-btn').forEach(b => b.classList.remove('step-active')); };
    </script>
</body>
</html>
